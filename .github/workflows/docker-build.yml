# Reusable docker build workflow
# Checks out the repo and builds the required docker image

on:
  workflow_call:
    inputs:
      context:
        required: true
        type: string
      tag:
        required: true
        type: string
      version:
        required: true
        type: string
    secrets:
      DOCKER_USER:
        required: true


jobs:
  docker-build:
    runs-on: ubuntu-latest
    steps:
      -
        name: Checkout repo
        uses: actions/checkout@v3
      -
        name: Build docker image
        run: docker build -t ${{ secrets.DOCKER_USER }}/${{ inputs.tag }}:${{ inputs.version }} ${{ inputs.context }}
      -
        name: Save docker image in artifact
        run: docker save -o /tmp/${{ inputs.tag }}.tar ${{ secrets.DOCKER_USER }}/${{ inputs.tag }}:${{ inputs.version }}
      -
        name: Upload docker image as artifact
        uses: actions/upload-artifact@v2
        with:
          name: ${{ inputs.tag }}
          path: /tmp/${{ inputs.tag }}.tar
